<div class="mx-auto flex max-w-200 flex-col gap-6">
  <div class="w-full">
    <div class="relative rounded-lg border border-border bg-background p-6 shadow-sm">
      <div class="flex flex-col gap-4">
        <div class="flex flex-col">
          <label class="text-label-14" for="word-search">Enter a word</label>
          <div class="relative mt-1 flex items-center">
            <input
              class="h-12"
              id="word-search"
              [formControl]="searchControl"
              (keyup.enter)="onSearch()"
              appInput
              placeholder="e.g. Serendipity"
              autocomplete="off"
            />
            @if (searchControl.value) {
              <button
                class="absolute right-2 inline-flex size-8 cursor-pointer items-center justify-center rounded-md border-transparent bg-transparent text-muted-foreground transition-all duration-150 hover:bg-muted"
                (click)="searchControl.setValue('')"
                aria-label="Clear"
              >
                <lucide-icon class="size-4" [img]="ICONS.X" />
              </button>
            }
          </div>
        </div>

        <div class="flex items-center gap-3">
          <button
            [disabled]="isLoading() || !searchControl.value"
            (click)="onSearch()"
            appButton
            variant="default"
            size="default"
          >
            @if (isLoading()) {
              <lib-spinner size="sm" variant="contrast" />
            } @else {
              Define
            }
          </button>

          <button
            [disabled]="isLoading()"
            (click)="onReset()"
            appButton
            variant="secondary"
            size="default"
          >
            Reset
          </button>

          <!-- History Dropdown -->
          <div class="relative ml-auto">
            <button
              class="inline-flex size-10 cursor-pointer items-center justify-center rounded-md border-transparent bg-muted text-foreground transition-all duration-150 hover:bg-accent-active disabled:cursor-not-allowed disabled:opacity-50"
              [attr.aria-expanded]="historyOpen()"
              [disabled]="searchHistory().length === 0"
              (click)="toggleHistory()"
              (keydown.escape)="historyOpen.set(false)"
              aria-label="Search History"
              title="Search History"
              aria-haspopup="listbox"
            >
              <lucide-icon class="size-5" [img]="ICONS.History" />
            </button>

            @if (historyOpen()) {
              <div
                class="absolute top-[calc(100%+8px)] right-0 z-50 w-70 overflow-hidden rounded-lg border border-border bg-background shadow-lg"
                role="listbox"
              >
                <div
                  class="flex items-center justify-between border-b border-border bg-muted px-4 py-3 text-[13px] font-medium text-muted-foreground"
                >
                  <span>Search History</span>
                  <button
                    class="inline-flex size-7 cursor-pointer items-center justify-center rounded-md border-transparent bg-transparent text-muted-foreground transition-all duration-150 hover:text-destructive"
                    (click)="clearHistory(); $event.stopPropagation()"
                    (keydown.escape)="historyOpen.set(false)"
                    aria-label="Clear History"
                    title="Clear History"
                  >
                    <lucide-icon class="size-4" [img]="ICONS.Trash2" />
                  </button>
                </div>
                <div class="max-h-75 overflow-y-auto p-1">
                  @for (word of searchHistory(); track word) {
                    <button
                      class="flex w-full cursor-pointer items-center gap-3 rounded-md border-none bg-transparent px-3 py-2 text-left text-sm text-foreground transition-colors duration-150 hover:bg-muted"
                      (click)="onSearch(word)"
                      (keydown.escape)="historyOpen.set(false)"
                      role="option"
                      aria-selected="false"
                    >
                      <lucide-icon class="size-4 text-muted-foreground" [img]="ICONS.Clock" />
                      <span>{{ word }}</span>
                    </button>
                  }
                </div>
              </div>
              <div
                class="fixed inset-0 z-40 cursor-default"
                (click)="historyOpen.set(false)"
                aria-hidden="true"
              ></div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <app-content-status [isLoading]="isLoading()" [error]="error()" [isEmpty]="!definition()">
    <div class="relative rounded-lg border border-border bg-background p-6 shadow-sm">
      <article
        class="prose [--tw-prose-body:var(--foreground)] [--tw-prose-bold:var(--foreground)] dark:prose-invert prose-headings:text-heading-24 prose-headings:leading-[inherit] prose-p:text-copy-16 prose-p:leading-[inherit] prose-strong:text-foreground prose-li:text-label-16 prose-li:leading-[inherit]"
        [innerHTML]="definition()"
      ></article>
    </div>
  </app-content-status>
</div>
